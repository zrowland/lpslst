# LPS/LST Tool
##### A tool for identifying LogRhythm SIEM log sources that are potentially being processed using an incorrect log source type

#### About

Depending on the quantity of log sources being collected in your LogRhythm SIEM, it can be relatively easy to mistakenly assign a log source an incorrect log source type. I've found that I encounter this situation the most often with syslog-based log sources, especially if multiple log sources are being routed through a syslog relay/host.

An example of this situation would be pointing the syslog stream from a VMWare ESX deployment at a LogRhythm agent, but then assigning the log source to the "Syslog - Linux Host" log source type (instead of "Syslog - VMWare ESX/ESXi Server"). Despite assigning the wrong log source type, it's possible that some messages from VMWare ESX may be processed and normalized as expected; this is particularly common with devices/products that use some sort of Linux distro as their "base" system. Due to the commonality of most Linux distros, programs such as "cron" or "sshd" are likely to appear in the syslog stream, along with log messages that are more specific to the device itself ("vpxa" logs would be a good example from VMWare ESX).

These factors can all combine in such a way that it is difficult to identify where (and if) this problem is occurring, also making it unlikely that an analyst/SIEM admin would notice unless they're looking for the problem.

One potential indicator of this problem that we can use to troubleshoot with is an abnormally high percentage of log messages hitting a log source type's "Catch All : Level 1" MPE rule. Not all log source types have a "Catch All : Level 1" MPE rule, but many do. This rule is typically written in such a broad manner that it can often match ANY syslog message, regardless of what device/product it came from. While a high hit rate on this rule doesn't *necessarily* mean that an incorrect log source type is assigned, it can still be very helpful for confirming whether this issue is occurring or not.

The LPS/LST tool is written in PowerShell - it should be relatively version-agnostic (vis-a-vis different PowerShell versions). The script can be pointed to a single "lps_detail.log" file, or a folder containing multiple "lps_detail.log" files. This log file is generated by the LogRhythm Mediator component, and can typically be found on your LogRhythm Data Processor at the following path:

`C:\Program Files\LogRhythm\LogRhythm Mediator Server\logs\lps_detail.log`

By default, the tool will flag log source types where greater than 50% of the total log volume is only being processed/matched by the log source type's "Catch All : Level 1" MPE rule. This percentage value can be overridden to any desired value using the `-CatchAllPercent` parameter. Values below 50% are likely to generate more false-positive results. By default the script displays the results in standard output, but this can also be overidden to write the results to an output file using the `-OutputFilePath` parameter.

#### Example Usage

Execute script against a single "lps_detail.log" file, writing the results to an output file:

`.\lpslst.ps1 -FilePath ".\logs\lps_detail.log" -OutputFilePath "lst_list.csv"`

Execute script against a folder (which contains multiple "lps_detail.log" files), writing the results to an output file:

`.\lpslst.ps1 -FolderPath ".\logs" -OutputFilePath "lst_list2.csv"`

Execute script against a folder and overriding the default "Catch All" threshold from 50% to 70%; results displayed in standard out:

`.\lpslst.ps1 -FolderPath ".\logs" -OutputFilePath "lst_list3.csv" -CatchAllPercent "70.0"`

#### License

Copyright (c) 2018 LogRhythm, Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.